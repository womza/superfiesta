!function(e){function t(t,a,i){function d(){v.children().length%2!=0&&(f.closed&&f.covers?v.children().last().before(wt):v.children().last().after(wt)),f.closed&&(e(vt).attr({title:f.closedFrontTitle||"Beginning",rel:f.closedFrontChapter||"Beginning of Book"}).prependTo(v),v.children().last().attr({title:f.closedBackTitle||"End",rel:f.closedBackChapter||"End of Book"}),v.append(vt)),"LTR"==f.direction?T=0:(T=v.children().length,f.closed&&(T-=2),f.covers&&(T-=2),e(v.children().get().reverse()).each(function(){e(this).appendTo(v)})),v.children().each(function(t){bt[t]=e(this).attr("rel")?e(this).attr("rel"):"",ft[t]=e(this).attr("title"),e(this).wrap(e(this).hasClass("b-page-empty")?'<div class="b-page"><div class="b-wrap"></div></div>':f.closed&&f.covers&&(1==t||t==v.children().length-2)?'<div class="b-page"><div class="b-wrap b-page-cover"></div></div>':t%2!=0?'<div class="b-page"><div class="b-wrap b-wrap-right"></div></div>':'<div class="b-page"><div class="b-wrap b-wrap-left"></div></div>'),e(this).parents(".b-page").addClass("b-page-"+t),f.pageNumbers&&!e(this).hasClass("b-page-empty")&&(!f.closed||f.closed&&!f.covers||f.closed&&f.covers&&1!=t&&t!=v.children().length-2)&&("LTR"==f.direction&&T++,e(this).parent().append('<div class="b-counter">'+T+"</div>"),"RTL"==f.direction&&T--)})}function n(){if(b.find(".b-page").removeClass("b-pN b-p0 b-p1 b-p2 b-p3 b-p4").hide(),H)for(T=f.pTotal-1,m=0;m<f.pTotal;m++)b.find(".b-page-"+m).detach().appendTo(v);f.curr-2>=0&&(b.find(".b-page-"+(f.curr-2)).addClass("b-pN").show(),b.find(".b-page-"+(f.curr-1)).addClass("b-p0").show()),b.find(".b-page-"+f.curr).addClass("b-p1").show(),b.find(".b-page-"+(f.curr+1)).addClass("b-p2").show(),f.curr+3<=f.pTotal&&(b.find(".b-page-"+(f.curr+2)).addClass("b-p3").show(),b.find(".b-page-"+(f.curr+3)).addClass("b-p4").show()),N=b.find(".b-pN"),C=b.find(".b-p0"),L=b.find(".b-p1"),B=b.find(".b-p2"),I=b.find(".b-p3"),R=b.find(".b-p4"),M=b.find(".b-pN .b-wrap"),O=b.find(".b-p0 .b-wrap"),F=b.find(".b-p1 .b-wrap"),S=b.find(".b-p2 .b-wrap"),D=b.find(".b-p3 .b-wrap"),Q=b.find(".b-p4 .b-wrap"),A=b.find(".b-wrap"),A.attr("style",""),A.css({width:f.pWidth-2*f.pagePadding,height:f.pHeight-2*f.pagePadding,padding:f.pagePadding}),L.css({left:0,width:f.pWidth,height:f.pHeight}),B.css({left:f.pWidth,width:f.pWidth,opacity:1,height:f.pHeight}),N.css({left:0,width:f.pWidth,height:f.pHeight}),C.css({left:0,width:0,height:f.pHeight}),I.stop().css({left:2*f.pWidth,width:0,height:f.pHeight,paddingLeft:0}),D.stop().css({left:0}),R.css({left:f.pWidth,width:f.pWidth,height:f.pHeight}),f.curr+3<=f.pTotal?(I.after(C.detach()),L.after(R.detach())):C.detach().appendTo(v),H=!0,E=j=null,b.find(".b-shadow-b, .b-shadow-f").remove(),f.shadows&&(E=e('<div class="b-shadow-f"></div>').appendTo(I).css({right:0,width:f.pWidth,height:f.pHeight}),j=e('<div class="b-shadow-b"></div>').appendTo(C).css({left:0,width:f.pWidth,height:f.pHeight}))}function s(t,a,i){a&&t>2?(b.find(".b-p3, .b-p4").removeClass("b-p3 b-p4").hide(),b.find(".b-page-"+f.curr).addClass("b-p3").show().stop().css({left:2*f.pWidth,width:0,height:f.pHeight,paddingLeft:0}),b.find(".b-page-"+(f.curr+1)).addClass("b-p4").show().css({left:f.pWidth,width:f.pWidth,height:f.pHeight}),b.find(".b-page-"+f.curr+" .b-wrap").show().css({width:f.pWidth-2*f.pagePadding,height:f.pHeight-2*f.pagePadding,padding:f.pagePadding}),b.find(".b-page-"+(f.curr+1)+" .b-wrap").show().css({width:f.pWidth-2*f.pagePadding,height:f.pHeight-2*f.pagePadding,padding:f.pagePadding}),I=b.find(".b-p3"),R=b.find(".b-p4"),D=b.find(".b-p3 .b-wrap"),Q=b.find(".b-p4 .b-wrap"),k&&I.css({left:f.width-40,width:20,"padding-left":10}),i.appendTo(I),L.after(R.detach()),B.after(I.detach())):!a&&t>2&&(b.find(".b-pN, .b-p0").removeClass("b-pN b-p0").hide(),b.find(".b-page-"+f.curr).addClass("b-pN").show().css({left:0,width:f.pWidth,height:f.pHeight}),b.find(".b-page-"+(f.curr+1)).addClass("b-p0").show().css({left:0,width:0,height:f.pHeight}),b.find(".b-page-"+f.curr+" .b-wrap").show().css({width:f.pWidth-2*f.pagePadding,height:f.pHeight-2*f.pagePadding,padding:f.pagePadding}),b.find(".b-page-"+(f.curr+1)+" .b-wrap").show().css({width:f.pWidth-2*f.pagePadding,height:f.pHeight-2*f.pagePadding,padding:f.pagePadding}),N=b.find(".b-pN"),C=b.find(".b-p0"),M=b.find(".b-pN .b-wrap"),O=b.find(".b-p0 .b-wrap"),y&&(C.css({left:10,width:40}),O.css({right:10})),i.appendTo(C),C.detach().appendTo(v)),f.closed&&(a||0!=f.curr?a||N.show():N.hide(),a&&f.curr>=f.pTotal-2?R.hide():a&&R.show()),f.shadows&&(e.support.opacity?i.animate({opacity:1},f.speedH,f.easeIn).animate({opacity:0},f.speedH,f.easeOut):a?i.animate({right:f.shadowTopFwdWidth},f.speed,f.easeIn):i.animate({left:f.shadowTopBackWidth},f.speed,f.easeIn))}function r(){n(),o(),p(),f.after.call(g,f),W=!1}function p(){(f.overlays||f.tabs||f.arrows)&&(f.curr<f.pTotal-2?_.fadeIn("fast").css("cursor",f.cursor):_.fadeOut("fast").css("cursor","default"),f.curr>=2&&0!=f.curr?et.fadeIn("fast").css("cursor",f.cursor):et.fadeOut("fast").css("cursor","default"))}function o(){f.pageSelector&&("RTL"==f.direction?(nums=Math.abs(f.curr-f.pTotal)-1+" - "+Math.abs(f.curr-f.pTotal),f.closed&&(nums=f.curr==f.pTotal-2?"1":0==f.curr?f.pTotal-2:Math.abs(f.curr-f.pTotal)-2+" - "+(Math.abs(f.curr-f.pTotal)-1),f.covers&&(nums=f.curr==f.pTotal-2?"":0==f.curr?"":Math.abs(f.curr-f.pTotal)-3+" - "+(Math.abs(f.curr-f.pTotal)-2))),e(f.menu+" .b-selector-page .b-current").text(nums)):(nums=f.curr+1+" - "+(f.curr+2),f.closed&&(nums=0==f.curr?"1":f.curr==f.pTotal-2?f.pTotal-2:f.curr+"-"+(f.curr+1),f.covers&&(nums=0==f.curr?"":f.curr==f.pTotal-2?"":f.curr-1+"-"+f.curr)),e(f.menu+" .b-selector-page .b-current").text(nums))),f.chapterSelector&&(""!=bt[f.curr]?e(f.menu+" .b-selector-chapter .b-current").text(bt[f.curr]):""!=bt[f.curr+1]&&e(f.menu+" .b-selector-chapter .b-current").text(bt[f.curr+1]),"RTL"==f.direction&&""!=bt[f.curr+1]?e(f.menu+" .b-selector-chapter .b-current").text(bt[f.curr+1]):""!=bt[f.curr]&&e(f.menu+" .b-selector-chapter .b-current").text(bt[f.curr]))}function h(){w=l(),!isNaN(w)&&w<=f.pTotal-1&&w>=0&&""!=w?(w%2!=0&&w--,f.curr=w):u(f.curr+1,f),g.hash=w}function c(){w=l(),!isNaN(w)&&w<=f.pTotal-1&&w>=0&&w!=f.curr&&w.toString()!=g.hash&&(w%2!=0&&w--,document.title=f.name+" - Page "+(w+1),W||(g.gotoPage(w),g.hash=w))}function l(){var e=window.location.hash.split("/");return e.length>1?parseInt(e[2])-1:""}function u(e,t){t.hash&&(window.location.hash="/page/"+e)}var g,f,b,v,w,m,T,x,P,W,H,k,y,N,C,L,B,I,R,M,O,F,S,D,Q,A,E,j,X,q,z,G,J,K,U,V,Y,Z,$,_,et,tt,at,it,dt,nt,st,rt,pt,ot,ht,ct,lt,ut,gt,ft=new Array,bt=new Array,vt='<div class="b-page-empty" title="" rel=""></div>',wt='<div class="b-page-blank" title="" rel=""></div>';if(W=!1,H=!1,k=y=!1,g=this,g.options=a,g.id=i,g.hash="",f=g.options,b=t.addClass("booklet"),v=b.children(".b-load"),d(),b.data("booklet",!0),b.data("id",i),b.data("total",v.children().length),f.width||(f.width=b.width()),f.height||(f.height=b.height()),b.width(f.width),b.height(f.height),f.pWidth=f.width/2,f.pWidthN="-"+f.width/2+"px",f.pWidthH=f.width/4,f.pHeight=f.height,f.pTotal=v.children().length,f.speedH=f.speed/2,"LTR"==f.direction?f.curr=0:"RTL"==f.direction&&(f.curr=f.pTotal-2),!isNaN(f.startingPage)&&f.startingPage<=f.pTotal&&f.startingPage>0&&(f.startingPage%2!=0&&f.startingPage--,f.curr=f.startingPage),f.name?document.title=f.name:f.name=document.title,f.shadows&&(f.shadowTopFwdWidth="-"+f.shadowTopFwdWidth+"px",f.shadowTopBackWidth="-"+f.shadowTopBackWidth+"px"),f.menu){if(tt=e(f.menu).addClass("b-menu"),x=f.curr,f.pageSelector){for(it=e('<div class="b-selector b-selector-page"><span class="b-current">'+(x+1)+" - "+(x+2)+"</span></div>").appendTo(tt),dt=e("<ul></ul>").appendTo(it).empty().css("height","auto"),m=0;m<f.pTotal;m+=2)T=m,nums=T+1+"-"+(T+2),f.closed&&(T--,nums=0==m?"1":m==f.pTotal-2?f.pTotal-2:T+1+"-"+(T+2),f.covers&&(T--,nums=0==m?"":m==f.pTotal-2?"":T+1+"-"+(T+2))),"RTL"==f.direction?(nums=Math.abs(T-f.pTotal)-1+" - "+Math.abs(T-f.pTotal),f.closed&&(nums=m==f.pTotal-2?"1":0==m?f.pTotal-2:Math.abs(T-f.pTotal)-3+" - "+(Math.abs(T-f.pTotal)-2),f.covers&&(nums=m==f.pTotal-2?"":0==m?"":Math.abs(T-f.pTotal)-5+" - "+(Math.abs(T-f.pTotal)-4))),it.find(".b-current").text(nums),st=e('<li><a href="#/page/'+(m+1)+'" id="selector-page-'+m+'"><span class="b-text">'+ft[m+1]+'</span><span class="b-num">'+nums+"</span></a></li>").prependTo(dt)):(0==m&&it.find(".b-current").text(nums),st=e('<li><a href="#/page/'+(m+1)+'" id="selector-page-'+m+'"><span class="b-text">'+ft[m]+'</span><span class="b-num">'+nums+"</span></a></li>").appendTo(dt)),rt=st.find("a"),f.hash||rt.click(function(){return"RTL"==f.direction&&it.find(".b-current").text(e(this).find(".b-num").text()),pt=parseInt(e(this).attr("id").replace("selector-page-","")),g.gotoPage(pt),!1});nt=dt.height(),dt.css({height:0,"padding-bottom":0}),it.unbind("hover").hover(function(){dt.stop().animate({height:nt,paddingBottom:10},500)},function(){dt.stop().animate({height:0,paddingBottom:0},500)})}if(f.chapterSelector){for(at=bt[f.curr],""==at&&(at=bt[f.curr+1]),ot=e('<div class="b-selector b-selector-chapter"><span class="b-current">'+at+"</span></div>").appendTo(tt),ht=e("<ul></ul>").appendTo(ot).empty().css("height","auto"),m=0;m<f.pTotal;m+=1)""!=bt[m]&&"undefined"!=typeof bt[m]&&("RTL"==f.direction?(T=m,T%2!=0&&T--,ot.find(".b-current").text(bt[m]),lt=e('<li><a href="#/page/'+(T+1)+'" id="selector-page-'+T+'"><span class="b-text">'+bt[m]+"</span></a></li>").prependTo(ht)):lt=e('<li><a href="#/page/'+(m+1)+'" id="selector-page-'+m+'"><span class="b-text">'+bt[m]+"</span></a></li>").appendTo(ht),ut=lt.find("a"),f.hash||ut.click(function(){return"RTL"==f.direction&&ot.find(".b-current").text(e(this).find(".b-text").text()),gt=parseInt(e(this).attr("id").replace("selector-page-","")),g.gotoPage(gt),!1}));ct=ht.height(),ht.css({height:0,"padding-bottom":0}),ot.unbind("hover").hover(function(){ht.stop().animate({height:ct,paddingBottom:10},500)},function(){ht.stop().animate({height:0,paddingBottom:0},500)})}}e.extend(g,{next:function(){W||g.gotoPage(f.curr+2)},prev:function(){W||g.gotoPage(f.curr-2)},gotoPage:function(e){e>f.curr&&e<f.pTotal&&e>=0&&!W?(W=!0,P=e-f.curr,f.curr=e,f.before.call(g,f),o(),p(),u(f.curr+1,f),s(P,!0,E),B.stop().animate({width:0},f.speedH,f.easeIn),I.stop().animate({left:f.pWidthH,width:f.pWidthH,paddingLeft:f.shadowBtmWidth},f.speedH,f.easeIn).animate({left:0,width:f.pWidth,paddingLeft:0},f.speedH),D.animate({left:f.shadowBtmWidth},f.speedH,f.easeIn).animate({left:0},f.speedH,f.easeOut,function(){r()})):e<f.curr&&e<f.pTotal&&e>=0&&!W&&(W=!0,P=f.curr-e,f.curr=e,f.before.call(g,f),o(),p(),u(f.curr+1,f),s(P,!1,j),L.animate({left:f.pWidth,width:0},f.speed,f.easing),F.animate({left:f.pWidthN},f.speed,f.easing),C.animate({left:f.pWidthH,width:f.pWidthH},f.speedH,f.easeIn).animate({left:f.pWidth,width:f.pWidth},f.speedH,f.easeOut),O.animate({right:f.shadowBtmWidth},f.speedH,f.easeIn).animate({right:0},f.speedH,f.easeOut,function(){r()}))}}),f.next&&(Z=e(f.next),Z.click(function(e){e.preventDefault(),g.next()})),f.prev&&($=e(f.prev),$.click(function(e){e.preventDefault(),g.prev()})),f.overlays&&(z=e('<div class="b-overlay b-overlay-prev b-prev" title="Previous Page"></div>').appendTo(b),q=e('<div class="b-overlay b-overlay-next b-next" title="Next Page"></div>').appendTo(b),X=b.find(".b-overlay"),e.browser.msie&&X.css({background:"#fff",filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0) !important"})),f.tabs?(K=e('<div class="b-tab b-tab-prev b-prev" title="Previous Page">Previous</div>').appendTo(b),J=e('<div class="b-tab b-tab-next b-next" title="Next Page">Next</div>').appendTo(b),G=b.find(".b-tab"),f.tabWidth&&G.width(f.tabWidth),f.tabHeight&&G.height(f.tabHeight),G.css({top:"-"+J.outerHeight()+"px"}),b.css({marginTop:J.outerHeight()}),"RTL"==f.direction&&(J.html("Previous").attr("title","Previous Page"),K.html("Next").attr("title","Next Page"))):b.css({marginTop:0}),f.arrows&&(Y=e('<div class="b-arrow b-arrow-prev b-prev" title="Previous Page"><div>Previous</div></div>').appendTo(b),V=e('<div class="b-arrow b-arrow-next b-next" title="Next Page"><div>Next</div></div>').appendTo(b),U=b.find(".b-arrow"),"RTL"==f.direction&&(V.html("<div>Previous</div>").attr("title","Previous Page"),Y.html("<div>Next</div>").attr("title","Next Page"))),_=b.find(".b-next"),et=b.find(".b-prev"),_.click(function(e){e.preventDefault(),g.next()}),et.click(function(e){e.preventDefault(),g.prev()}),f.hovers&&(_.hover(function(){!W&&f.curr+2<=f.pTotal-2&&(B.stop().animate({width:f.pWidth-40},500,f.easing),I.stop().animate({left:f.width-40,width:20,paddingLeft:10},500,f.easing),k=!0)},function(){!W&&f.curr+2<=f.pTotal-2&&(B.stop().animate({width:f.pWidth},500,f.easing),I.stop().animate({left:f.width,width:0,paddingLeft:0},500,f.easing),k=!1)}),et.hover(function(){!W&&f.curr-2>=0&&(L.stop().animate({left:10,width:f.pWidth-10},400,f.easing),F.stop().animate({left:"-10px"},400,f.easing),C.stop().animate({left:10,width:40},400,f.easing),O.stop().animate({right:10},400,f.easing),y=!0)},function(){!W&&f.curr-2>=0&&(L.stop().animate({left:0,width:f.pWidth},400,f.easing),F.stop().animate({left:0},400,f.easing),C.stop().animate({left:0,width:0},400,f.easing),O.stop().animate({right:0},400,f.easing),y=!1)})),f.arrows&&(e.support.opacity?(_.hover(function(){V.find("div").stop().fadeTo("fast",1)},function(){V.find("div").stop().fadeTo("fast",0)}),et.hover(function(){Y.find("div").stop().fadeTo("fast",1)},function(){Y.find("div").stop().fadeTo("fast",0)})):(_.hover(function(){V.find("div").show()},function(){V.find("div").hide()}),et.hover(function(){Y.find("div").show()},function(){Y.find("div").hide()}))),f.keyboard&&e(document).keyup(function(e){37==e.keyCode?g.prev():39==e.keyCode&&g.next()}),f.hash&&(h(),clearInterval(),setInterval(function(){c()},250)),n()}e.fn.booklet=function(a){var i=e.extend({},e.fn.booklet.defaults,a);return e(this).each(function(){var d,n,s,r,p,o;if("string"==typeof a)e(this).data("booklet")&&(d=a.toLowerCase(),s=e.fn.booklet.interfaces[e(this).data("id")],"next"==d?s.next():"prev"==d&&s.prev());else if("number"==typeof a)e(this).data("booklet")&&(o=a,s=e.fn.booklet.interfaces[e(this).data("id")],o%2!=0&&(o-=1),s.gotoPage(o));else{for(n=e.extend(!0,{},i),r=e.fn.booklet.interfaces.length,p=0;r>p;p++)if("undefined"==typeof e.fn.booklet.interfaces[p]){r=p;break}s=new t(e(this),n,r),e.fn.booklet.interfaces[r]=s}})},e.fn.booklet.interfaces=[],e.fn.booklet.defaults={name:null,width:600,height:400,speed:1e3,direction:"LTR",startingPage:0,easing:"easeInOutQuad",easeIn:"easeInQuad",easeOut:"easeOutQuad",closed:!1,closedFrontTitle:null,closedFrontChapter:null,closedBackTitle:null,closedBackChapter:null,covers:!1,pagePadding:10,pageNumbers:!0,hovers:!0,overlays:!0,tabs:!1,tabWidth:60,tabHeight:20,arrows:!1,cursor:"pointer",hash:!1,keyboard:!0,next:null,prev:null,menu:null,pageSelector:!1,chapterSelector:!1,shadows:!0,shadowTopFwdWidth:166,shadowTopBackWidth:166,shadowBtmWidth:50,before:function(){},after:function(){}}}(jQuery);
